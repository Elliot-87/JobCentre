{% extends 'base.html' %}
{% load static %}
{% load currency_filters %}
{% block title %}JobCentre Timeline{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-8">

  <!-- Page Header -->
  <div class="text-center mb-10">
    <h1 class="text-3xl font-bold text-gray-900">JobCentre Timeline</h1>
    <p class="mt-2 text-lg text-gray-600">Scroll through the latest opportunities and discover your next move</p>
  </div>

  <!-- Filters -->
  <div class="bg-white/70 backdrop-blur-sm rounded-2xl shadow-lg p-6 mb-10 border border-white/50">
    <form method="get" class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div>
        <label for="job_type" class="block text-sm font-medium text-gray-700 mb-2">Job Type</label>
        <select name="job_type" id="job_type" 
                class="w-full border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring-blue-500">
          <option value="">All Types</option>
          {% for value, label in job_types %}
            <option value="{{ value }}" {% if request.GET.job_type == value %}selected{% endif %}>{{ label }}</option>
          {% endfor %}
        </select>
      </div>
      <div>
        <label for="location" class="block text-sm font-medium text-gray-700 mb-2">Location</label>
        <input type="text" name="location" id="location" value="{{ request.GET.location }}" 
               placeholder="Enter location" 
               class="w-full border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring-blue-500">
      </div>
      <div class="flex items-end">
        <button type="submit" 
                class="w-full bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
          Filter Jobs
        </button>
      </div>
    </form>
  </div>

  <!-- Timeline Feed -->
  <div class="space-y-8">
    {% for vacancy in vacancies %}
    <div class="bg-white rounded-2xl shadow-md p-6 border border-gray-100 hover:shadow-xl transition-all duration-300">
      
      <!-- Employer + Posted Date -->
      <div class="flex items-center mb-4">
        <img src="{{ vacancy.employer.profile_image.url|default:'/static/img/placeholder.png' }}"
             alt="{{ vacancy.company }}" 
             class="w-10 h-10 rounded-full object-cover border border-gray-200 mr-3">
        <div>
          <h3 class="text-sm font-semibold text-gray-900">{{ vacancy.company }}</h3>
          <p class="text-xs text-gray-500">{{ vacancy.posted_date|timesince }} ago</p>
        </div>
      </div>

      <!-- Job Info -->
      <a href="{{ vacancy.get_absolute_url }}">
        <h2 class="text-lg font-bold text-blue-700 mb-1">{{ vacancy.title }}</h2>
      </a>
      <p class="text-sm text-gray-600 mb-3 line-clamp-3">{{ vacancy.description|truncatewords:30 }}</p>

      <!-- Meta Info -->
      <div class="flex flex-wrap text-sm text-gray-500 mb-4 space-x-4">
        <span>üìç {{ vacancy.location }}</span>
        {% if vacancy.salary %}
          <span>üí∞ {{ vacancy.salary|format_zar }}</span>
        {% endif %}
        <span class="px-2 py-1 rounded-full text-xs font-medium bg-gray-100">{{ vacancy.get_job_type_display }}</span>
      </div>

      <!-- Attachment Preview -->
      {% if vacancy.attachment %}
        {% if vacancy.is_image %}
          <img src="{{ vacancy.attachment.url }}" alt="{{ vacancy.title }}" 
               class="rounded-lg mx-auto mb-4 max-h-64 object-contain border">
        {% elif vacancy.is_pdf %}
          <iframe src="{{ vacancy.attachment.url }}" class="w-full h-60 rounded-lg border mb-4" allowfullscreen></iframe>
        {% else %}
          <a href="{{ vacancy.attachment.url }}" target="_blank" 
             class="inline-flex items-center px-3 py-2 text-sm font-medium text-blue-600 hover:underline mb-4">
            ‚¨á Download Attachment
          </a>
        {% endif %}
      {% endif %}

      <!-- Actions -->
      <div class="flex justify-between items-center mt-3 text-sm">
        <a href="{{ vacancy.get_absolute_url }}" 
           class="text-blue-600 hover:text-blue-800 font-medium">View Details</a>
        <div class="space-x-3">
          <button class="text-gray-500 hover:text-red-600">‚ù§Ô∏è Save</button>
          <button class="text-gray-500 hover:text-blue-600">üîó Share</button>
        </div>
      </div>
    </div>
    {% empty %}
    <div class="text-center py-12">
      <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
      </svg>
      <h3 class="mt-2 text-lg font-medium text-gray-900">No vacancies found</h3>
      <p class="mt-1 text-gray-500">Try adjusting your filters or check back later.</p>
    </div>
    {% endfor %}
  </div>

  <!-- Pagination -->
  {% if is_paginated %}
  <div class="flex justify-center mt-8 space-x-4">
    {% if page_obj.has_previous %}
      <a href="?page={{ page_obj.previous_page_number }}" 
         class="px-4 py-2 text-sm text-blue-600 hover:underline">Previous</a>
    {% endif %}
    <span class="px-4 py-2 text-gray-600">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
    {% if page_obj.has_next %}
      <a href="?page={{ page_obj.next_page_number }}" 
         class="px-4 py-2 text-sm text-blue-600 hover:underline">Next</a>
    {% endif %}
  </div>
  {% endif %}
</div>
{% endblock %}
